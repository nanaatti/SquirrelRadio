<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>JWPlayer Audio Playlist</title>
    <script src="https://content.jwplatform.com/libraries/QA8aoWzd.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>

<div id="audioPlayer"></div>
<div id="playlistSelection">
    <button type="button" onclick="loadPlaylist('playlist.json')">All</button>
    <!-- <button type="button" onclick="loadPlaylist('custom.json')">Custom</button> -->
    <button type="button" onclick="loadPlaylist('saved')">Saved</button>
</div>
<div id="songList">Playlist:</div>
<div id="nowPlaying"></div>
<div id="test">
    <button type="button" onclick="addSong()">Add Song</button>
    <button type="button" onclick="savePlaylist()">Save</button>
</div>

<script type="text/javascript">

var json;

var playerInstance = jwplayer("audioPlayer");
playerInstance.setup({
    width: 640,
	height: 40,
    repeat: false,
    autostart: false,
    playlist: "playlist.json",
    volume: 100
});

loadPlaylist('playlist.json');

function onPlay(){
    jwplayer("audioPlayer").on('play', function(){
        var audio = jwplayer().getPlaylistItem();
        document.getElementById("nowPlaying").innerHTML = "Now Playing: " + audio.title + " | " + audio.duration + "<br> <img src=\"" + audio.poster + "\" style=\"width:200px;height:200px;\">";
    });
}
    
jwplayer("audioPlayer").on('complete', function(){
    clearInfo();
});

function loadPlaylist(name){
    clearList();
    clearInfo();

    console.log(name);
    if (/\w*.json/.test(name) == true) {

        playerInstance.setup({
        width: 640,
	    height: 40,
        repeat: false,
        autostart: false,
        playlist: name,
        volume: 100
        });

        $.getJSON(name)
        .done(function(data) {
            console.log(data);
            for (i = 0; i < data.playlist.length; i++) {
                document.getElementById("songList").innerHTML += "</br>" + data.playlist[i].mediaid + " | " + "<button type=\"button\" onclick=\"playSong(" + data.playlist[i].mediaid + ")\">" + data.playlist[i].title + "</button>" + " | " + data.playlist[i].duration;
            }
        })
        .fail(function() {
            console.log( "error" );
        });
        onPlay();
    }

    else {

        playerInstance.setup({
            width: 640,
	        height: 40,
            repeat: false,
            autostart: false,
            playlist: saved,
            volume: 100
        });

        for (i = 0; i < saved.playlist.length; i++) {
            document.getElementById("songList").innerHTML += "</br>" + saved.playlist[i].mediaid + " | " + "<button type=\"button\" onclick=\"playSong(" + saved.playlist[i].mediaid + ")\">" + saved.playlist[i].title + "</button>" + " | " + saved.playlist[i].duration;
        }
        
        onPlay();
    }
}

function playSong(x) {
    jwplayer().playlistItem(x-1);
}

function clearList(){
    document.getElementById("songList").innerHTML = "Playlist:";
}

function clearInfo(){
    document.getElementById("nowPlaying").innerHTML = "";
}
    
var saved = {
    playlist: [

    ]
};

var mid = 0;
    
function addSong() {
    mid = mid+1;

    var audio = jwplayer().getPlaylistItem();

    saved.playlist.push({
    "mediaid": mid,
    "file": audio.file,
    "title": audio.title,
    "duration": audio.duration,
    "type": audio.type,
    "poster": audio.poster
    });
}

function savePlaylist() {
    console.log(saved);
}

</script>
    
</body>
    
</html>